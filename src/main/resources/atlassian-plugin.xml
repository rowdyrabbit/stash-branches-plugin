<?xml version="1.0" encoding="UTF-8"?>

<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" plugins-version="2">
  <plugin-info>
    <description>${project.description}</description>
    <version>${project.version}</version>
    <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    <param name="plugin-icon">images/pluginIcon.png</param>
    <param name="plugin-logo">images/pluginLogo.png</param>
  </plugin-info>
  
  <!-- add our i18n resource -->
  <resource type="i18n" name="i18n" location="stash-branch-list-plugin"/>
  
  <stash-resource key="branchlist-soy">
    <directory location="/templates/">
        <exclude>/**/server-side*.*</exclude>
    </directory>
    <resource type="download" name="stash-branch-list-plugin.css" location="css/stash-branch-list-plugin.css"/>
    <resource type="download" name="stash-branch-list-plugin.js" location="js/stash-branch-list-plugin.js"/>
    <dependency>com.atlassian.auiplugin:ajs</dependency>
    <dependency>com.atlassian.stash.stash-web-plugin:infinite-table</dependency>
    <dependency>com.atlassian.stash.stash-web-api:branch-selector-field</dependency>
    <dependency>com.atlassian.stash.stash-web-plugin:global</dependency>
    <dependency>com.atlassian.stash.stash-web-plugin:repository-branch-selector</dependency>
    <dependency>com.atlassian.stash.stash-web-plugin:user-multiselect</dependency>
    <dependency>com.atlassian.auiplugin:aui-experimental-tooltips</dependency>
    <context>stash-branch-list-plugin</context>
  </stash-resource>
  
  <stash-resource key="branchlist-soy-server">
  	<directory location="/templates/">
       <include>/**/*.soy</include>
   	</directory>
    <dependency>com.atlassian.stash.stash-web-plugin:server-soy-templates</dependency>
  </stash-resource>
  
  <!-- import from the product container -->
  <component-import key="applicationProperties" interface="com.atlassian.sal.api.ApplicationProperties"/>
  <component-import key="gitCommandBuilderFactory" interface="com.atlassian.stash.scm.git.GitCommandBuilderFactory"/>
  <component-import key="soyTemplateRenderer" interface="com.atlassian.soy.renderer.SoyTemplateRenderer"/>
  <component-import key="gitAgent" interface="com.atlassian.stash.scm.git.GitAgent"/>
  <component-import key="webResourceManager" interface="com.atlassian.plugin.webresource.WebResourceManager"/>
  <component-import key="repositoryMetadataService" interface="com.atlassian.stash.repository.RepositoryMetadataService"/>
  <component-import key="templateRenderer" interface="com.atlassian.templaterenderer.TemplateRenderer"/>
  <component-import key="loggingService" interface="com.atlassian.stash.config.log.LoggingService"/>
  
  <!-- publish our components -->
  <component key="branchService" class="au.com.denisefernandez.stash.plugin.branchlist.service.BranchServiceImpl"/>
  
  <!-- servlets -->
  <servlet name="Branch List Servlet" i18n-name-key="branch-list-servlet.name" key="branch-list-servlet" class="au.com.denisefernandez.stash.plugin.branchlist.servlet.BranchListServlet">
    <url-pattern>/branches/*</url-pattern>
  </servlet>
  
  <!-- web items -->
  <web-item name="Branches" i18n-name-key="branch-list.name" key="branch-list" section="stash.repository.nav" weight="1000">
    <link linkId="branch-list-link">/plugins/servlet/branches/${repository.project.key}/${repository.slug}</link>
    <label key="branch-list.label">Branches</label>
    <condition class="com.atlassian.stash.web.conditions.RepositoryNotEmptyCondition"/>
  </web-item>
  
  <!-- rest components -->
  <rest name="Branch Comparison Resource" i18n-name-key="branch-comparison-resource.name" key="branch-comparison-resource" path="/branchcomparison" version="1.0">
  	<dispatcher>REQUEST</dispatcher>
  	<dispatcher>FORWARD</dispatcher>
  </rest>
  
</atlassian-plugin>
